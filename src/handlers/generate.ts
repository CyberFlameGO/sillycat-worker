import { initialize, svg2png } from "svg2png-wasm";
import wasm from "../../node_modules/svg2png-wasm/svg2png_wasm_bg.wasm";

export async function generateImage(
  color1: string,
  color2: string,
  spotCount?: number,
  spotColors?: string[]
) {
  // do this using svg
  const svg = `<svg width="400" height="400" viewBox="0 0 400 400" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path fill="#CC27DA" fill-rule="evenodd" clip-rule="evenodd" d="M196.556 116.906C197.182 116.984 198.292 116.985 199.023 116.909C199.754 116.833 199.242 116.769 197.885 116.768C196.529 116.766 195.93 116.828 196.556 116.906ZM327.759 117.554C322.596 118.288 316.483 119.703 305.022 122.815C294.095 125.782 288.474 126.995 282.758 127.62L278.943 128.037L268.018 126.01C240.462 120.898 215.507 117.063 214.746 117.824C213.866 118.704 212.925 149.013 213.541 156.652C215.557 181.659 227.862 204.867 249.449 224.373C275.641 248.041 300.55 253.321 372.033 250.357L377.018 250.151L377.262 243.401C378.228 216.73 373.469 199.293 360.315 181.309C355.757 175.078 352.15 169.644 350.812 166.993C349.267 163.933 349.319 163.346 352.609 146.59C355.034 134.242 355.377 123.411 353.393 121.845C348.432 117.93 337.723 116.138 327.759 117.554ZM116.828 128.634C116.384 128.825 116.319 128.937 116.652 128.937C116.943 128.937 117.498 128.801 117.885 128.634C118.33 128.443 118.395 128.331 118.062 128.331C117.771 128.331 117.216 128.468 116.828 128.634ZM86.6964 140.441C86.2114 140.718 85.9744 140.944 86.1674 140.944C86.3614 140.944 86.9164 140.718 87.4014 140.441C87.8854 140.164 88.1234 139.937 87.9304 139.937C87.7364 139.937 87.1814 140.164 86.6964 140.441ZM53.3754 162.555L51.9824 164.053L53.4804 162.66C54.8734 161.364 55.1404 161.057 54.8734 161.057C54.8164 161.057 54.1424 161.731 53.3754 162.555ZM48.7884 167.137L47.7534 168.282L48.8994 167.247C49.9664 166.282 50.2064 165.991 49.9344 165.991C49.8734 165.991 49.3584 166.507 48.7884 167.137ZM270.837 181.856C282.408 183.143 289.348 194.795 285.663 206.749C284.186 211.54 275.214 216.76 268.368 216.81C255.623 216.904 245.505 205.639 247.379 193.44C248.879 183.673 255.917 180.198 270.837 181.856ZM168.018 203.955C168.648 204.034 169.678 204.034 170.308 203.955C170.938 203.877 170.423 203.813 169.163 203.813C167.903 203.813 167.388 203.877 168.018 203.955ZM178.59 203.96C179.608 204.031 181.273 204.031 182.291 203.96C183.308 203.889 182.476 203.831 180.441 203.831C178.405 203.831 177.573 203.889 178.59 203.96ZM162.907 204.296C163.247 204.384 163.802 204.384 164.141 204.296C164.48 204.207 164.203 204.135 163.524 204.135C162.846 204.135 162.568 204.207 162.907 204.296ZM188.634 204.305C189.167 204.386 190.04 204.386 190.573 204.305C191.106 204.225 190.67 204.158 189.604 204.158C188.537 204.158 188.101 204.225 188.634 204.305ZM230.044 222.628C230.48 222.712 231.194 222.712 231.63 222.628C232.066 222.544 231.709 222.475 230.837 222.475C229.965 222.475 229.608 222.544 230.044 222.628ZM236.236 228.018C236.236 229.278 236.3 229.793 236.378 229.163C236.456 228.533 236.456 227.502 236.378 226.872C236.3 226.242 236.236 226.758 236.236 228.018ZM149.339 232.854C149.969 232.932 151 232.932 151.63 232.854C152.26 232.776 151.744 232.712 150.485 232.712C149.225 232.712 148.709 232.776 149.339 232.854ZM203.789 232.856C204.515 232.932 205.705 232.932 206.432 232.856C207.159 232.78 206.564 232.718 205.11 232.718C203.656 232.718 203.062 232.78 203.789 232.856ZM229.939 242.555L228.546 244.053L230.044 242.66C231.437 241.364 231.704 241.057 231.437 241.057C231.38 241.057 230.706 241.731 229.939 242.555ZM148.288 251.181C148.922 251.259 149.873 251.257 150.403 251.177C150.932 251.097 150.414 251.032 149.251 251.034C148.088 251.036 147.655 251.102 148.288 251.181ZM203.965 251.532C204.595 251.611 205.626 251.611 206.256 251.532C206.885 251.454 206.37 251.39 205.11 251.39C203.85 251.39 203.335 251.454 203.965 251.532ZM312.863 291.702C313.3 291.786 314.013 291.786 314.449 291.702C314.885 291.618 314.529 291.55 313.656 291.55C312.784 291.55 312.427 291.618 312.863 291.702ZM93.3044 292.061C93.9344 292.139 94.9654 292.139 95.5954 292.061C96.2254 291.983 95.7094 291.919 94.4494 291.919C93.1894 291.919 92.6744 291.983 93.3044 292.061ZM294.89 292.055C295.326 292.139 296.04 292.139 296.476 292.055C296.912 291.971 296.555 291.902 295.683 291.902C294.811 291.902 294.454 291.971 294.89 292.055ZM148.106 292.42C149.414 292.488 151.555 292.488 152.863 292.42C154.172 292.352 153.101 292.297 150.485 292.297C147.868 292.297 146.797 292.352 148.106 292.42ZM268.106 292.414C268.736 292.492 269.767 292.492 270.396 292.414C271.026 292.335 270.511 292.271 269.251 292.271C267.991 292.271 267.476 292.335 268.106 292.414Z" />
  <path fill="#0E0E08" fill-rule="evenodd" clip-rule="evenodd" d="M77.8852 98.8309C61.6012 101.76 55.8582 108.726 51.2822 131.101C50.3902 135.463 49.2682 140.334 48.7872 141.927L47.9142 144.823L41.0952 151.971C27.2182 166.517 23.3492 171.76 16.7782 184.927C7.1692 204.179 4.1322 228.479 8.2832 252.893C12.0262 274.91 16.5212 285.765 25.7192 295L29.0752 298.369L32.0702 299.145C40.3782 301.295 46.9622 302.458 57.4452 303.626C66.6952 304.657 100.069 304.963 203.7 304.968C321.742 304.974 332.58 304.822 349.186 302.925C355.255 302.232 362.551 301.527 365.397 301.359C372.822 300.92 374.08 300.165 378.734 293.358C389.342 277.844 397.002 249.36 395.121 232.423C392.175 205.894 385.467 187.803 371.466 168.624C368.939 165.163 366.872 162.084 366.872 161.782C366.873 161.481 367.34 158.688 367.911 155.576C373.444 125.428 371.17 113.882 358.203 106.291C345.121 98.6329 326.672 98.8629 298.502 107.035C280.224 112.338 279.085 112.383 261.498 108.485C241.774 104.113 237.627 103.352 227.489 102.237C205.116 99.7779 185.479 100.032 161.762 103.09C146.776 105.021 142.288 105.39 133.693 105.394C123.717 105.399 122.711 105.242 107.489 101.284C97.3492 98.6469 84.7222 97.6009 77.8852 98.8309ZM211.454 117.377C226.558 118.712 238.525 120.538 268.018 126.01L278.943 128.037L282.758 127.62C288.474 126.995 294.095 125.782 305.022 122.815C332.234 115.425 344.934 115.171 353.393 121.845C355.377 123.411 355.034 134.242 352.609 146.59C349.319 163.346 349.267 163.933 350.812 166.993C352.15 169.644 355.757 175.078 360.315 181.309C371.614 196.757 375.835 208.987 377.106 229.956C378.633 255.151 374.035 274.539 363.795 286.078C361.837 288.285 357.196 289.033 341.322 289.701C336.282 289.913 330.176 290.325 327.753 290.617C325.33 290.91 320.811 291.289 317.709 291.46C291.577 292.904 96.0892 292.784 79.8242 291.313C63.2382 289.814 57.0822 289.346 51.2782 289.141C40.9862 288.778 40.3072 288.389 34.9072 279.758C24.6502 263.363 20.4312 242.305 22.8472 219.559C24.9842 199.436 36.8522 177.785 54.8302 161.21C67.6412 149.399 86.2552 139.263 110.661 130.808C122.844 126.587 121.991 126.797 142.379 122.991C171.625 117.53 193.276 115.771 211.454 117.377ZM97.8302 176.958C89.5652 178.896 80.7692 187.314 79.2832 194.706C78.0232 200.974 81.6412 208.892 86.5202 210.543C98.5012 214.596 113.119 203.863 113.119 191.013C113.119 181.732 105.873 175.071 97.8302 176.958ZM257.391 182.197C251.216 183.816 248.366 187.017 247.379 193.44C245.157 207.906 260.084 220.545 273.908 215.904C284.007 212.514 288.259 205.456 286.189 195.517C283.944 184.737 270.835 178.673 257.391 182.197ZM167.225 204.058C158.619 204.595 156.253 205.046 155.089 206.371C153.82 207.817 151.449 211.863 150.798 213.695L150.315 215.055L151.721 216.252C152.495 216.91 155.705 219.466 158.855 221.93C162.004 224.395 164.581 226.515 164.581 226.642C164.581 227.646 157.24 231.725 154.104 232.462C148.325 233.822 146.459 232.982 133.428 223.145C130.347 220.819 127.651 218.991 127.437 219.081C127.01 219.263 122.059 225.071 120.681 227.007L119.815 228.224L120.524 230.997C123.752 243.616 134.249 250.731 149.604 250.707C155.714 250.697 156.308 250.58 168.811 246.92C171.04 246.267 173.974 245.539 175.33 245.301L177.797 244.869L184.67 247.031C197.372 251.029 197.6 251.073 205.639 251.071C224.258 251.066 236.591 241.358 236.068 227.116C235.92 223.081 235.845 222.998 232.166 222.808C226.566 222.519 223.631 223.509 216.035 228.249C208.358 233.04 209.011 232.779 204.758 232.753C202.722 232.741 200.185 232.541 199.119 232.31C196.612 231.766 188.806 229.405 188.442 229.081C188.288 228.944 190.229 227.362 192.754 225.566C199.207 220.976 206.579 213.448 205.564 212.486C203.676 210.696 198.1 206.632 196.385 205.795C193.26 204.271 178.203 203.374 167.225 204.058Z" />
  <path fill="#54C4FC" fill-rule="evenodd" clip-rule="evenodd" d="M185.022 117.234C184.344 117.299 181.727 117.525 179.207 117.736C169.52 118.55 157.46 120.273 143.436 122.846C125.139 126.204 124.767 126.294 113.304 130.156C71.2181 144.332 46.6021 162.685 32.0951 190.706C24.7451 204.901 22.3741 215.209 22.4161 232.775C22.4621 251.891 26.1371 265.515 35.1601 280.026C40.2511 288.214 41.0341 288.663 50.9251 289.059C54.9961 289.221 63.7181 289.831 70.3081 290.413C89.8491 292.139 94.9371 292.216 192.952 292.278C287.85 292.337 317.082 292.033 324.564 290.91C327.765 290.43 332.052 290.129 346.884 289.346C353.905 288.975 360.489 288.151 361.923 287.464C365.461 285.767 371.383 275.336 374.122 265.972C375.337 261.82 377.413 250.775 377.047 250.41C376.948 250.311 371.328 250.42 364.557 250.651C294.783 253.038 268.774 245.96 242.425 217.417C217.287 190.185 210.773 168.977 214.084 125.14C214.383 121.184 214.563 117.882 214.485 117.803C213.873 117.192 190.272 116.736 185.022 117.234ZM104.964 177.479C120.98 184.599 111.844 210.504 93.0131 211.368C84.4681 211.76 78.9431 206.411 78.9431 197.746C78.9431 185.889 95.2731 173.17 104.964 177.479ZM187.786 204.048C194.78 204.438 196.149 204.96 201.818 209.399C206.356 212.953 206.131 212.465 204.349 214.883C201.243 219.098 197.421 222.569 191.44 226.608C187.938 228.973 187.945 228.82 191.278 229.914C197.258 231.877 199.271 232.294 203.764 232.497C208.926 232.73 208.683 232.814 215.571 228.428C223.422 223.429 227.493 222.053 232.813 222.598C235.683 222.892 236.006 223.216 236.316 226.115C237.82 240.151 224.219 251.349 205.639 251.371C198.877 251.38 196.924 250.998 185.495 247.431L177.69 244.995L174.396 245.644C172.584 246.001 168.485 247.08 165.286 248.04C157.171 250.478 154.216 251.037 149.427 251.038C134.247 251.043 122.826 242.84 120.19 230.037L119.771 228.003L121.621 225.632C124.179 222.354 127.256 218.855 127.581 218.855C127.73 218.855 130.758 221.021 134.31 223.669C137.862 226.316 142.179 229.409 143.903 230.541L147.037 232.599L150.083 232.595C154.818 232.588 157.58 231.637 162.045 228.472C164.831 226.498 165.088 226.953 158.035 221.405C154.755 218.824 151.633 216.278 151.097 215.747L150.124 214.78L151.49 211.972C154.915 204.924 154.805 204.985 165.991 203.93C168.723 203.672 182.38 203.746 187.786 204.048Z" />
  </svg>`;
  // const svg = `
  // <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" fill="white">
  //   <rect width="100" height="100" fill="${color1}" />
  //   <rect width="100" height="100" fill="${color2}" />
  //   ${Array.from({ length: spotCount || 0 }, (_, i) => {
  //     return `
  //       <circle
  //         cx="${Math.random() * 100}"
  //         cy="${Math.random() * 100}"
  //         r="${Math.random() * 10}"
  //         fill="${spotColors?.[i] || "#fff"}"
  //       />
  //     `;
  //   }).join("")}
  // </svg>
  // `;

  await initialize(wasm).catch(() => {});
  const image = await svg2png(svg, {
    scale: 1,
  });

  return new Response(image, {
    headers: {
      "content-type": "image/png",
    },
  });
}
